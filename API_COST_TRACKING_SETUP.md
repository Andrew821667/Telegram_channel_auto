# üí∞ API Cost Tracking - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1. **–ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (app/models/database.py)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `APIUsage` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `MonthlyAPIStats` –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–µ—Å—è—á–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 2. **–ú–æ–¥—É–ª—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è** (app/modules/api_usage_tracker.py)
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `calculate_cost()` - —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ —Ç–æ–∫–µ–Ω–∞–º
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `track_api_usage()` - –∑–∞–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ë–î
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_current_month_cost()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—è—á–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã (–¥–µ–∫–∞–±—Ä—å 2024):
  - GPT-4o: $2.50/$10.00 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤ (prompt/completion)
  - GPT-4o-mini: $0.15/$0.60 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
  - Perplexity Sonar: $0.20/$0.20 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤

### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏** (app/modules/llm_provider.py)
- ‚úÖ OpenAI: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ `response.usage`
- ‚úÖ Perplexity: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ `response.usage`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ `track_api_usage()` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: operation, article_id, draft_id

### 4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–æ—Ç–µ** (app/bot/handlers.py)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_statistics()` –≤ –∫–æ–º–∞–Ω–¥–µ `/stats`
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
  - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤
  - Breakdown –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º (OpenAI/Perplexity)

### 5. **SQL –º–∏–≥—Ä–∞—Ü–∏—è** (migrations/add_api_usage_tracking.sql)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `api_usage`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `monthly_api_stats`
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ–ª—è–º

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ:**

```bash
# –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Docker (–µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã)
cat migrations/add_api_usage_tracking.sql | docker compose exec -T postgres psql -U legal_user -d legal_ai_news

# –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
psql -U legal_user -d legal_ai_news -f migrations/add_api_usage_tracking.sql
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
docker compose exec postgres psql -U legal_user -d legal_ai_news -c "\dt" | grep -E "(api_usage|monthly_api_stats)"

# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
# public | api_usage         | table | legal_user
# public | monthly_api_stats | table | legal_user
```

---

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞
docker compose restart celery_worker bot app

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
docker compose logs -f celery_worker bot | grep -i error
```

---

### –®–∞–≥ 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ

#### 3.1 –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π

```bash
# –í Telegram –±–æ—Ç–µ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É:
/fetch
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç —Å–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥—Ä–∞—Ñ—Ç–æ–≤, —á—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –∑–∞–ø–∏—Å–∏ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ API.

#### 3.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å–∏ –≤ api_usage
docker compose exec postgres psql -U legal_user -d legal_ai_news -c "SELECT provider, model, operation, total_tokens, cost_usd FROM api_usage ORDER BY created_at DESC LIMIT 5;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—è—á–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
docker compose exec postgres psql -U legal_user -d legal_ai_news -c "SELECT * FROM monthly_api_stats ORDER BY year DESC, month DESC LIMIT 3;"
```

#### 3.3 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–æ—Ç–µ

```bash
# –í Telegram –±–æ—Ç–µ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É:
/stats
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã

üì∞ –í—Å–µ–≥–æ —Å—Ç–∞—Ç–µ–π: 123
üìù –í—Å–µ–≥–æ –¥—Ä–∞—Ñ—Ç–æ–≤: 45
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: 12
‚è≥ –û–∂–∏–¥–∞—é—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏: 3

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å API –∑–∞ December 2025

üíµ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: $0.1234
üìä –í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤: 45,678
üî¢ –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 25

–ü–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º:
‚îú‚îÄ OpenAI:
‚îÇ  ‚îú‚îÄ –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.0890
‚îÇ  ‚îú‚îÄ –¢–æ–∫–µ–Ω–æ–≤: 30,000
‚îÇ  ‚îî‚îÄ –ó–∞–ø—Ä–æ—Å–æ–≤: 15
‚îú‚îÄ Perplexity:
‚îÇ  ‚îú‚îÄ –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.0344
‚îÇ  ‚îú‚îÄ –¢–æ–∫–µ–Ω–æ–≤: 15,678
‚îÇ  ‚îî‚îÄ –ó–∞–ø—Ä–æ—Å–æ–≤: 10

üìÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ: 28.12.2025 20:45
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker compose exec postgres psql -U legal_user -d legal_ai_news -c "\du"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
docker compose exec postgres psql -U legal_user -d legal_ai_news -c "SELECT current_database();"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç $0.0000

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –≤ api_usage
docker compose exec postgres psql -U legal_user -d legal_ai_news -c "SELECT COUNT(*) FROM api_usage WHERE date >= CURRENT_DATE - INTERVAL '30 days';"

# –ï—Å–ª–∏ 0 - –∑–Ω–∞—á–∏—Ç —Å–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è –∏–ª–∏ –Ω–µ –±—ã–ª–æ API –≤—ã–∑–æ–≤–æ–≤
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ /fetch –≤ –±–æ—Ç–µ
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª api_usage_tracker.py –Ω–∞ –º–µ—Å—Ç–µ
ls -la app/modules/api_usage_tracker.py

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose restart celery_worker bot app
```

---

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ

### 1. **–ó–∞–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

–ö–∞–∂–¥—ã–π —Ä–∞–∑ –∫–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è LLM API (OpenAI –∏–ª–∏ Perplexity):

```python
# –í app/modules/llm_provider.py
response = await client.chat.completions.create(...)

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î:
await track_api_usage(
    db=db,
    provider="openai",  # –∏–ª–∏ "perplexity"
    model="gpt-4o-mini",
    operation="draft_generation",  # –∏–ª–∏ "ranking", "editing", etc.
    prompt_tokens=response.usage.prompt_tokens,
    completion_tokens=response.usage.completion_tokens,
    article_id=article_id,
    draft_id=draft_id
)
```

### 2. **–†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏**

```python
# –ü—Ä–∏–º–µ—Ä –¥–ª—è GPT-4o-mini:
prompt_tokens = 1000
completion_tokens = 500

# –°—Ç–æ–∏–º–æ—Å—Ç—å = (1000 / 1_000_000) * $0.15 + (500 / 1_000_000) * $0.60
# –°—Ç–æ–∏–º–æ—Å—Ç—å = $0.00015 + $0.0003 = $0.00045
```

### 3. **–ú–µ—Å—è—á–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è**

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `monthly_api_stats`:

```python
# –£–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è —Å—á—ë—Ç—á–∏–∫–∏:
- total_requests += 1
- total_tokens += (prompt_tokens + completion_tokens)
- total_cost_usd += calculated_cost
```

### 4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `/stats`:

```python
# –ó–∞–ø—Ä–æ—Å –∫ monthly_api_stats –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
api_cost_data = await get_current_month_cost(db)

# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
```

---

## üìù –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```sql
-- –£–¥–∞–ª–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 6 –º–µ—Å—è—Ü–µ–≤ (–º–µ—Å—è—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è)
DELETE FROM api_usage
WHERE date < CURRENT_DATE - INTERVAL '6 months';
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω

–ï—Å–ª–∏ —Ü–µ–Ω—ã –Ω–∞ API –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `app/modules/api_usage_tracker.py`:

```python
PRICING = {
    "openai": {
        "gpt-4o-mini": {
            "prompt": 0.150,     # –û–±–Ω–æ–≤–∏—Ç–µ –∑–¥–µ—Å—å
            "completion": 0.600  # –ò –∑–¥–µ—Å—å
        }
    }
}
```

### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

```bash
# –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ API
docker compose exec postgres psql -U legal_user -d legal_ai_news -c "COPY (SELECT * FROM api_usage) TO STDOUT WITH CSV HEADER" > api_usage_export.csv

# –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Å—è—á–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
docker compose exec postgres psql -U legal_user -d legal_ai_new -c "COPY (SELECT * FROM monthly_api_stats) TO STDOUT WITH CSV HEADER" > monthly_stats_export.csv
```

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–∞–º—ã–µ –¥–æ—Ä–æ–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```sql
SELECT
    operation,
    COUNT(*) as requests,
    SUM(total_tokens) as total_tokens,
    SUM(cost_usd) as total_cost_usd,
    AVG(cost_usd) as avg_cost_per_request
FROM api_usage
WHERE date >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY operation
ORDER BY total_cost_usd DESC;
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–æ–¥–µ–ª—è–º

```sql
SELECT
    provider,
    model,
    COUNT(*) as requests,
    SUM(cost_usd) as total_cost
FROM api_usage
WHERE date >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY provider, model
ORDER BY total_cost DESC;
```

### –î–∏–Ω–∞–º–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –¥–Ω—è–º

```sql
SELECT
    date,
    COUNT(*) as requests,
    SUM(total_tokens) as tokens,
    SUM(cost_usd) as cost_usd
FROM api_usage
WHERE date >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY date
ORDER BY date DESC;
```

---

## üìû –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ "–∑–∞–≤–∏—Å"

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º—è–Ω—É–ª "–ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–∏—Å". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ Celery worker:**
   ```bash
   docker compose logs -f celery_worker | tail -100
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏:**
   ```bash
   docker compose exec celery_worker celery -A app.tasks.celery_tasks inspect active
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å worker:**
   ```bash
   docker compose restart celery_worker
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram API:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å session —Ñ–∞–π–ª
   ls -la telegram_bot.session

   # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
   python setup_telegram_session.py
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –±—Ä–æ–∫–µ—Ä):**
   ```bash
   docker compose exec redis redis-cli ping
   # –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: PONG
   ```

---

## ‚úÖ Checklist –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] SQL –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- [ ] –¢–∞–±–ª–∏—Ü—ã `api_usage` –∏ `monthly_api_stats` —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã
- [ ] –ö–æ–º–∞–Ω–¥–∞ `/fetch` –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í –ë–î –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞–ø–∏—Å–∏ –≤ `api_usage`
- [ ] –ö–æ–º–∞–Ω–¥–∞ `/stats` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å API
- [ ] –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç

---

**–í–µ—Ä—Å–∏—è:** 1.0.0
**–î–∞—Ç–∞:** 2025-12-28
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Code Complete, ‚è≥ Testing Required
**–ö–æ–º–º–∏—Ç:** c489ee0
